---
title: "R Notebook"
output: html_notebook
params:
  out_prefix: "~/mount/CT/git_test/results"
---



```{r}
library(Seurat)
library(ggplot2)
library(pheatmap)

set.seed(2020)
```


```{r}
load(paste0(params$out_prefix,"H3K4me3/spreading/spreading.Rdata"))

ann_row <- mOL.signature[,c('cluster','pseudotime'),drop=FALSE]


# Sort the cells in the heatmap by mOL Signature
ann_row    <- ann_row[order(ann_row$pseudotime),]

########################### OLG lineage

# Sample less cells for faster plotting
OPCs <- rownames(ann_row[ann_row$cluster == 'OPC',])
mOLs <- sample(rownames(ann_row[ann_row$cluster == 'mOL',]),1000)

# Select only OPCs and mOLS
ann_row <- ann_row[c(OPCs,mOLs),]
ann_row$cluster <- factor(as.character(ann_row$cluster),levels=c("OPC","mOL"))
ann_row <- ann_row[order(ann_row$pseudotime),]

# Sepcify the colors
ann_colors                 <- list("cluster"=scales::hue_pal()(5)[c(2,5)])
names(ann_colors$cluster)  <- levels(ann_row$cluster)


# Adapt the color scale
# breaks         <- seq(from = data.range[1],to= data.range[1] + 0.5 * (data.range[2]-data.range[1]),length.out = 11)
breaks         <- seq(0,quantile(distances.to.promoters.heatmap,0.99),length.out = 11)

pheatmap(distances.to.promoters.heatmap[rownames(ann_row),17000:30000],
         cluster_cols = FALSE,cluster_rows = FALSE,labels_col = FALSE,labels_row = FALSE,
         annotation_row = ann_row,annotation_colors = ann_colors,
         viridis::viridis(10),breaks=breaks,fontsize = 22,
         filename = "../Figure3_src/spreading_heatmap_H3K4me3.png",width = 10,height=10)

```


